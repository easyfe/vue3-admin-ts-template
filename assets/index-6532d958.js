var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,s=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&l(e,a,t[a]);return e},i=(e,n)=>t(e,a(n));import{g as u}from"./index-38fba92e.js";import{e as d,r as c,a as p,c as h,A as m,h as v,j as f,k as y,F as g,O as x,l as w,n as b,i as N,w as E,o as L,z as _,G as M,K as j,L as D,m as P,D as k,a9 as O,q as z,C as I}from"./core-e904f21d.js";import{_ as U}from"./index-2bd40bfa.js";import"./ui-4b961b37.js";const C=d({name:"TheDraggableContainer"}),$=U(d(i(s({},C),{props:{grid:{default:void 0}},setup(e){const t=e,a=c([]),n=p({matchedLine:null}),o=h((()=>n.matchedLine&&n.matchedLine.row)),r=h((()=>n.matchedLine&&n.matchedLine.col)),l=h((()=>{const e={};return t.grid&&(e.backgroundImage="linear-gradient(to right, #ccc 1px, transparent 1px), linear-gradient(to bottom, #ccc 1px, transparent 1px)",e.backgroundSize=`${t.grid[0]}px ${t.grid[1]}px`),e}));return m("list",a),m("setMatchedLine",(e=>{n.matchedLine=e})),(e,a)=>(v(),f("div",{id:"the-draggable-container",class:b(["the-draggable-container",t.grid&&"the-draggable-grid"]),style:w(l.value)},[y(e.$slots,"default",{},void 0,!0),(v(!0),f(g,null,x(o.value,((e,t)=>(v(),f("span",{key:t,style:w({width:e.width+"px",height:"0",left:e.left+"px",top:e.top+"px",borderTop:"2px solid red",position:"absolute"})},null,4)))),128)),(v(!0),f(g,null,x(r.value,((e,t)=>(v(),f("span",{key:t,style:w({width:"0",height:e.height+"px",top:e.top+"px",left:e.left+"px",borderLeft:"2px solid red",position:"absolute"})},null,4)))),128))],6))}})),[["__scopeId","data-v-48eed5b8"]]),T=["onMousedown"],X=d({name:"TheDraggableItem"}),Y=U(d(i(s({},X),{props:{id:{},w:{},h:{},x:{},y:{},minW:{default:10},minH:{default:10},active:{type:Boolean,default:!1}},emits:["update:active","update:x","update:y","update:w","update:h"],setup(e,{emit:t}){const a=e,n=c(N("list")),o=N("setMatchedLine"),r=c(null);let l=null,s=null,i=null,u=null;const d=h((()=>({position:"absolute",width:isNaN(Number(a.w))?a.w:a.w+"px",height:isNaN(Number(a.h))?a.h:a.h+"px",transform:`translate3d(${isNaN(Number(a.x))?a.x:a.x+"px"}, ${isNaN(Number(a.y))?a.y:a.y+"px"}, 0px)`}))),p=h((()=>[{name:"tl",style:{top:"0",left:"0",cursor:"nwse-resize",transform:"translate(-50%, -50%)"}},{name:"tm",style:{top:"0",left:"50%",cursor:"ns-resize",transform:"translate(-50%, -50%)"}},{name:"tr",style:{top:"0",right:"0",cursor:"nesw-resize",transform:"translate(50%, -50%)"}},{name:"ml",style:{top:"50%",left:"0",cursor:"ew-resize",transform:"translate(-50%, -50%)"}},{name:"mr",style:{top:"50%",right:"0",cursor:"ew-resize",transform:"translate(50%, -50%)"}},{name:"bl",style:{bottom:"0",left:"0",cursor:"nesw-resize",transform:"translate(-50%, 50%)"}},{name:"bm",style:{bottom:"0",left:"50%",cursor:"ns-resize",transform:"translate(-50%, 50%)"}},{name:"br",style:{bottom:"0",right:"0",cursor:"nwse-resize",transform:"translate(50%, 50%)"}}]));let m="";const z=h((()=>({x:[a.x,a.x+a.w/2,a.x+a.w],y:[a.y,a.y+a.h/2,a.y+a.h]})));function I(e){var t,a=new Image;a.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' %3E%3Cpath /%3E%3C/svg%3E",null==(t=null==e?void 0:e.dataTransfer)||t.setDragImage(a,0,0)}function U(e){return r=this,u=null,d=function*(){if(!(l&&s&&e.clientX&&e.clientY))return;const r=(null==i?void 0:i.scrollTop)||0,u=(null==i?void 0:i.scrollLeft)||0;let d=Math.ceil(e.clientX-l.left-s.offsetX)+u,c=Math.ceil(e.clientY-l.top-s.offsetY)+r;d>=0&&d+Number(a.w)<=l.width&&t("update:x",d),c>=0&&c+Number(a.h)<=l.height&&t("update:y",c),_((()=>{!function(){var e;if(!o)return;const r=null==(e=n.value)?void 0:e.filter((e=>e._id!==a.id)),l={row:[],col:[]};if(!r)return;const s=r.map((e=>({x:[e.x,e.x+e.w/2,e.x+e.w],y:[e.y,e.y+e.h/2,e.y+e.h]})));z.value.x.forEach((e=>{let n={};s.forEach(((o,r)=>{o.x.forEach((o=>{const l=e-o;Math.abs(l)<=10&&(t("update:x",a.x-l),n[o]?n[o].push(...s[r].y,...z.value.y):n[o]=[...s[r].y,...z.value.y])}))})),Object.keys(n).forEach((e=>{const t=Math.min(...n[Number(e)]),a=Math.max(...n[Number(e)]);l.col.push({top:t,left:Number(e),height:a-t})}))})),z.value.y.forEach((e=>{let n={};s.forEach(((o,r)=>{o.y.forEach((o=>{const l=e-o;Math.abs(l)<=10&&(t("update:y",a.y-l),n[o]?n[o].push(...s[r].x,...z.value.x):n[o]=[...s[r].x,...z.value.x])}))})),Object.keys(n).forEach((e=>{const t=Math.min(...n[Number(e)]),a=Math.max(...n[Number(e)]);l.row.push({top:Number(e),left:t,width:a-t})}))})),o(l)}()}))},new Promise(((e,t)=>{var a=e=>{try{o(d.next(e))}catch(a){t(a)}},n=e=>{try{o(d.throw(e))}catch(a){t(a)}},o=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,n);o((d=d.apply(r,u)).next())}));var r,u,d}function C(e){e.stopPropagation(),s=null,o&&o(null)}function $(e){e.preventDefault()}function X(e){e.preventDefault()}function Y(e){var o;if(e.stopPropagation(),t("update:active",!0),null==(o=n.value)?void 0:o.length)for(let t of n.value)t._id!==a.id&&(t.active=!1);s=e}function B(e){m="",e.stopPropagation(),null==u||u.removeEventListener("mousemove",S,!0),null==u||u.removeEventListener("mouseup",B,!0)}function S(e){if(e.stopPropagation(),!s)return void console.warn("鼠标移动事件未触发");const{clientX:n,clientY:o}=e,{clientX:r,clientY:l}=s,i=n-r,u=o-l;"tl"===m?(t("update:x",a.x+i),t("update:y",a.y+u),t("update:w",a.w-i),t("update:h",a.h-u)):"tm"===m?(t("update:y",a.y+u),t("update:h",a.h-u)):"tr"===m?(t("update:y",a.y+u),t("update:w",a.w+i),t("update:h",a.h-u)):"mr"===m?t("update:w",a.w+i):"br"===m?(t("update:w",a.w+i),t("update:h",a.h+u)):"bm"===m?t("update:h",a.h+u):"bl"===m?(t("update:x",a.x+i),t("update:w",a.w-i),t("update:h",a.h+u)):"ml"===m&&(t("update:x",a.x+i),t("update:w",a.w-i)),s=e,_((()=>{}))}function q(e){console.log("触发mouseup"),e.stopPropagation(),s=null}return E((()=>a),(()=>{if(!n.value)return;const e=n.value.findIndex((e=>e._id===a.id));-1!==e?(n.value[e].w=a.w,n.value[e].h=a.h,n.value[e].x=a.x,n.value[e].y=a.y,n.value[e].active=a.active):n.value.push({_id:a.id,w:a.w,h:a.h,x:a.x,y:a.y,active:a.active})}),{immediate:!0,deep:!0}),L((()=>{_((()=>{u=document.getElementById("the-draggable-container"),l=(null==u?void 0:u.getBoundingClientRect())||null,i=document.getElementsByClassName("layout-content")[0],u&&(u.ondragover=function(e){e.preventDefault()})}))})),M((()=>{})),(e,t)=>(v(),f("div",{ref_key:"myself",ref:r,class:"the-draggable-item",style:w(O(d)),draggable:"true",onDragstart:I,onDrag:U,onDragend:C,onMousedown:Y,onMouseup:q,onDragenter:$,onDragove:X},[j(P("div",{class:b([a.active&&"active"])},[(v(!0),f(g,null,x(O(p),(e=>(v(),f("div",{key:e.name,class:"handle",style:w(e.style),onMousedown:k((t=>{return a=t,n=e.name,m=n,s=a,a.stopPropagation(),null==u||u.addEventListener("mousemove",S,!0),void(null==u||u.addEventListener("mouseup",B,!0));var a,n}),["stop","prevent"])},null,44,T)))),128))],2),[[D,a.active]]),y(e.$slots,"default",{},void 0,!0)],36))}})),[["__scopeId","data-v-db7227db"]]),B=U(d({__name:"index",setup(e){const t=c([{id:u(),x:100,y:100,w:100,h:120,active:!0,color:"black"},{id:u(),x:250,y:200,w:100,h:120,active:!1,color:"blue"},{id:u(),x:450,y:300,w:100,h:120,active:!1,color:"yellow"}]);function a(e){return{wdith:"100%",height:"100%",backgroundColor:e.color}}return(e,n)=>(v(),z($,{class:"container",grid:[15,15]},{default:I((()=>[(v(!0),f(g,null,x(O(t),(e=>(v(),z(Y,{key:e.id,id:e.id,h:e.h,"onUpdate:h":t=>e.h=t,w:e.w,"onUpdate:w":t=>e.w=t,x:e.x,"onUpdate:x":t=>e.x=t,y:e.y,"onUpdate:y":t=>e.y=t,active:e.active,"onUpdate:active":t=>e.active=t},{default:I((()=>[P("div",{style:w(a(e))},null,4)])),_:2},1032,["id","h","onUpdate:h","w","onUpdate:w","x","onUpdate:x","y","onUpdate:y","active","onUpdate:active"])))),128))])),_:1}))}}),[["__scopeId","data-v-4cd31529"]]);export{B as default};
